<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title></title>

    <script type="text/javascript" src="../js/jquery-1.9.0.js"></script>
    <script type="text/javascript" src="../js/login.js"></script>
    <script type="text/javascript" src="../js/jsencrypt.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/login.css"/>
    <script type="text/javascript">
        $(document).ready(function () {
            var publicKey = "${public_key}";
            var encrypt = new JSEncrypt();
            encrypt.setPublicKey(publicKey);

            function goLogin() {
                var $err = $('.err');

                if ($.trim($("#loginname").val()) == "") {
                    $("#loginname").focus();
                    $err.text("请输入用户名");
                    return false;
                }
                if ($.trim($("#loginpwd").val()) == "") {
                    $err.text("请输入密码");
                    $("#loginpwd").focus();
                    return false;
                }
                if ($.trim($("#verify").val()) == "") {
                    $err.text("请先填写验证码");
                    $("#verify").focus();
                    return false;
                }
                $('.button').prop('disabled', true);
                $.ajax({
                    url: "/seller/do_login",
                    type: 'POST',
                    dataType: 'text',
                    data: { login_name: $.trim($("#loginname").val()),
                            login_password: encrypt.encrypt($.trim($("#loginpwd").val())),
                            verify: $.trim($("#verify").val())},
                    success: function (data) {
                        loginOK(data);
                    },
                    error: function (error, textStatus, errorThrown) {
                        var responseJson = jQuery.parseJSON(error.responseText);
                        if (responseJson.code == "validation_code_not_correct" || responseJson.code == "login_failed") {
                            changeKaptcha();
                       }
                        $err.text(responseJson.message);
                        changeKaptcha();
                    }
                });
            }
            function loginOK(data) {
                showpopmsg("登录成功",300,25,5000) ;
                window.location.href= "/account/home";
            };
            var $button = $('.button');

            //判断条件请完善
            $button.click(function () {
                goLogin()
            });

            document.onkeydown = function (event) {
                e = event ? event : (window.event ? window.event : null);
                if (e.keyCode == 13) {
                    //执行的方法
                    goLogin();
                }
            }
        });
    </script>

</head>
<body>

<div class="login">
    <div class="login_form">
        <h2>保理商管理系统</h2>
        <div class="userName">
            <img src="../img/user.png"/>
            <input type="text" name="loginname" id="loginname" value="" placeholder="请输入用户名"/>
        </div>
        <div class="passWord">
            <img src="../img/psd.png"/>
            <input type="password" name="loginpwd" id="loginpwd" value="" maxlength="12" placeholder="请输入密码"/>
        </div>
        <div class="yzm">
            <img id="kaptcha" onClick="javascript:changeKaptcha();"
                 src="/captchaImage/kaptcha">
            <input type="text" name="verify" id="verify" maxlength="4" value="" placeholder="请输入验证码"/>
        </div>
        <p class="err"></p>
        <div class="button">
            <a href="javascript:;">登录</a>
        </div>
    </div>
    <div class="login_detail">
        <h3>保金所服务条件</h3>
        <p>作为本系统的注册用户，需负责维护您的账户保密和安全，不能讲您的账户信息透露给其他人或使用其他人的账户。</p>
        <p style="margin-top: 20px;"> 如有问题请联系保金所客服:</p>
        <p class="last">400-822-8587(10:00 - 18:00 周一至周五)</p>
    </div>
    <img src="../img/login-bg2.png" alt="" class="bgPic"/>
</div>
<!--<div id="ajaxshow" class="ajaxouter"><div id="ajaxmsg" class="ajaxbox"></div></div>-->

</body>
</html>