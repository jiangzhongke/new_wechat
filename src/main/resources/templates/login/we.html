<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="renderer" content="webkit">
    <meta name="format-detection" content="telephone=no" />
    <meta name="screen-orientation" content="portrait">
    <meta name="x5-orientation" content="portrait">
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta content="black" name="apple-mobile-web-app-status-bar-style">
    <title></title>
    <script type="text/javascript">
        (function(doc,win){
            var docEl = doc.documentElement,resizeEvt = 'orientationchange' in window ? 'orientationchange' : 'resize',
                recalc = function(){
                    var clientWidth = docEl.clientWidth;
                    if(!clientWidth) return;
                    if(clientWidth>=750){
                        docEl.style.fontSize = '100px';
                    }
                    else{
                        docEl.style.fontSize = 100 * (clientWidth / 750) + 'px';
                    }
                };
            if (!doc.addEventListener) return;
            win.addEventListener(resizeEvt, recalc, false);
            doc.addEventListener('DOMContentLoaded', recalc, false);
        })(document,window);
    </script>
    <link rel="stylesheet" type="text/css" href="../css/login.css"/>
    <link rel="stylesheet" type="text/css" href="../css/sina.css"/>
</head>
<body>
<div class="logo">
    <img src="../img/logo.png"/>
</div>
<div class="information find-password bind-bank-card-add">
    <ul class="mlist">
        <li class=" clearfix"><span class="name fl"><label for="yl-number1">姓名</label></span><span class="yname fr"><input type="test" name="mobile" id="realname" value=""  class="yl-number"  /></span></li>
        <li class=" clearfix"><span class="name fl"><label for="yl-number1">手机号</label></span><span class="yname fr"><input type="number" name="mobile" id="yl-number1" value=""  class="yl-number" oninput="if(value.length>11)value=value.slice(0,11)" /></span></li>
        <li class=" clearfix"><span class="name fl" style="width: 30%">
			<input type="text" id = "validcode" placeholder="验证码" class="yzm yzn"/> </span><span class="yname last fr"><input type="button" onclick="goUnBindCard(this);" value=" 短信获取" class="send-yzm"/></span>
        </li>
    </ul>
    <div class="button"><a  onclick="goUnBindCardVerify();" class="tipButton">绑定微信</a></div>
    <p class="err"></p>
    <!--<input type="button" id="" value="绑定微信"  class="login"/>-->
</div>
<!--<div class="form">-->
<!--<input type="text" name="mobile" id="mobile" value=""  placeholder="手机号" maxlength="11" oninput="this.value=this.value.replace(/\D/g,'')" onafterpaste="this.value=this.value.replace(/\D/g,'')" class="tel input"/>-->
<!--<input type="test" name="realname" id="realname" value=""  placeholder="真实姓名"  class="tel input"/>-->
<!--<p class="err"></p>-->
<!--<input type="button" id="" value="绑定微信"  class="login"/>-->
<!--</div>-->
</body>
<script src="../js/jquery.js"></script>
<script src="../js/fastclick.js" type="text/javascript" charset="utf-8"></script>
<script src="../js/jsencrypt.js" type="text/javascript"></script>
<script type="text/javascript">
    $(function () {
        var openId = "${open_id}";
        var publicKey = "${public_key}";
        var encrypt = new JSEncrypt();
        encrypt.setPublicKey(publicKey);
        FastClick.attach(document.body);

        var codeTemp = getQueryString("code");
        var isClear=0;
        $(".login").click(function(){
            goLogin()
        });
        function goLogin() {
            var mobile = $.trim($("#mobile").val());
            var password = $.trim($("#password").val());
            if (mobile == "") {
                $(".tel").focus();
                $(".err").text("请输入手机号");
                isClear++;
                return false;
            }
            if (password == "") {
                $(".passWord").focus();
                $(".err").text("请输入密码");
                isClear++;
                return false;
            }
            $.ajax({
                url: "/wxuser/login",
                type: 'POST',
                dataType: 'json',
                data: {
                    loginName: mobile,
                    loginPwd: encrypt.encrypt(password),
                    code:openId
                },
                success: function (data) {
                    window.location.href= "/wxuser/bindSuccess";
                },
                error: function (error, textStatus, errorThrown) {
                    var responseJson = jQuery.parseJSON(error.responseText);
                    $(".err").text(responseJson.message, 300, 25, 2000);
                }
            });
        }
    })


    function getQueryString(name)
    {
        var reg = new RegExp("(^|&)"+ name +"=([^&]*)(&|$)");
        var r = window.location.search.substr(1).match(reg);
        if(r!=null)return  unescape(r[2]); return null;
    }
</script>
</html>
